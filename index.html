<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>С любовью из Инно</title>

<style>

:root{
  --pink:#ffd6e0;
  --peach:#ffe7d6;
  --accent:#ff4d6d;
  --text:#2b2b2b;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Inter",sans-serif;
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:40px 0;
  box-sizing:border-box;
  background:linear-gradient(120deg,var(--pink),var(--peach),var(--pink));
  background-size:200% 200%;
  animation:bgShift 18s ease infinite;
}

@keyframes bgShift{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

.title{
  font-size:22px;
  margin-bottom:60px;
  color:var(--text);
  opacity:0.8;
}

.wrapper{
  position:relative;
  height:120px;
  width:90vw;
  max-width:640px;
  overflow:hidden;
  border-radius:28px;
  background:rgba(255,255,255,0.55);
  backdrop-filter:blur(12px);
  flex-shrink:0;
}

.fade-top,
.fade-bottom{
  position:absolute;
  width:100%;
  height:40%;
  pointer-events:none;
}

.fade-top{
  top:0;
  background:linear-gradient(to bottom,rgba(255,255,255,0.95),transparent);
}

.fade-bottom{
  bottom:0;
  background:linear-gradient(to top,rgba(255,255,255,0.95),transparent);
}

.center-line{
  position:absolute;
  width:100%;
  height:120px;
  border-top:1px solid rgba(0,0,0,0.08);
  border-bottom:1px solid rgba(0,0,0,0.08);
}

.bg-heart{
  position:absolute;
  width:18px;
  height:18px;
  pointer-events:none;
  opacity:0;
  z-index:0;
  transform:translate(-50%,0) scale(0.9);
  animation:heartFloat 5s ease-in-out forwards;
}

.bg-heart::before{
  content:"";
  position:absolute;
  width:100%;
  height:100%;
  background:#ff4d6d;
  clip-path:polygon(
    50% 12%,
    61% 0,
    75% 0,
    88% 4%,
    96% 13%,
    100% 27%,
    98% 40%,
    93% 50%,
    50% 100%,
    7% 50%,
    2% 40%,
    0 27%,
    4% 13%,
    12% 4%,
    25% 0,
    39% 0
  );
}

@keyframes heartFloat{
  0%{
    opacity:0;
    transform:translate(-50%,10px) scale(0.9);
  }
  10%{
    opacity:0.5;
  }
  50%{
    opacity:0.9;
  }
  100%{
    opacity:0;
    transform:translate(-50%,-40px) scale(1.1);
  }
}

.slot{
  position:absolute;
  width:100%;
}

.item{
  height:120px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
  font-weight:500;
  color:var(--text);
  text-align:center;
  padding:0 40px;
  box-sizing:border-box;
}

button{
  margin-top:50px;
  padding:16px 36px;
  font-size:18px;
  border-radius:999px;
  border:none;
  background:var(--accent);
  color:white;
  box-shadow:0 6px 18px rgba(255,77,109,0.28);
  cursor:pointer;
  transition:transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, opacity 0.2s ease;
}

button:hover{
  transform:translateY(-2px) scale(1.02);
  box-shadow:0 9px 24px rgba(255,77,109,0.38);
  opacity:0.96;
}

#download{
  margin-top:32px;
  color:var(--accent);
  cursor:pointer;
  font-size:16px;
  text-decoration:underline;
   text-underline-offset:4px;
   text-decoration-thickness:1px;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.25s ease;
}

@media (max-width:600px){
  body{
    justify-content:flex-start;
    padding-top:60px;
  }

  .title{
    font-size:18px;
    margin-bottom:40px;
    text-align:center;
    padding:0 16px;
  }

  .item{
    font-size:28px;
    padding:0 20px;
  }

  button{
    width:fit-content;
    min-width:220px;
    max-width:280px;
    font-size:16px;
    padding:14px 28px;
  }

  #download{
    font-size:14px;
  }
}


@media (max-height:500px){

  body{
    justify-content:flex-start;
    padding-top:20px;
    padding-bottom:20px;
  }

  .title{
    margin-bottom:20px;
  }

  button{
    margin-top:20px;
  }

}

</style>
</head>
<body>

<div id="bg-hearts-root"></div>

<div class="title">
  <img src="https://raw.githubusercontent.com/Deepkins/innoloves/main/logo/Inno_logo.svg" alt="Иннополис" style="height:32px;">
</div>

<div class="wrapper" id="wrapper">
<div class="fade-top"></div>
<div class="fade-bottom"></div>
<div class="center-line"></div>
<div class="slot" id="slot"></div>
</div>

<button onclick="spin()">Поймай свою валентинку</button>

<div id="download">Скачать валентинку</div>

<canvas id="canvas" width="1080" height="1350" style="display:none;"></canvas>
<!-- SVG логотип для открытки (загружается из JS с CORS) -->
<img
  id="logo"
  data-src="https://raw.githubusercontent.com/Deepkins/innoloves/main/logo/Inno_logo.svg"
  alt="Иннополис"
  style="display:none;"
/>

<script>

const messages=[
"Давай всегда встречать закаты вместе",
"Ты — мой главный генератор идей",
"Это не просто ветер, а буря моих чувств",
"Пишу тебе чаще, чем в консьерж",
"Давай смерджим наши жизни",
"Без тебя каждый дейлик становится скучным",
"Наши сердца слились, как Волга со Свиягой",
"404... причины не быть вместе",
"Ты — моя главная фича",
"У нашей любви нет дедлайнов",
"В Инно каждый день — твой",
"Ты на первом месте",
"Сохраняю твои сообщения в городских чатах",
"Ты — главный зайчик в городе",
"Зарелизим новую фичу?",
"У меня к тебе любовь с первого взгляда",
"Ты вызываешь вотерфол моих чувств",
"Давай вместо дня ног устроим день любви",
"Истинные Имоции",
"Наша любовь не выгорит",
"Хочу всегда быть вместе с тобой",
"Все вокруг сделано для тебя",
"Мур-р-р",
"К моим эмоциям не подобрать промпт",
"Сегодня тот самый день",
"Ценю и люблю наше легаси",
"С тобой всё по-инному",
"Наши чувства уже больше, чем стартап",
"Ты — единорог моей жизни",
"Твое счастье — мой базовый минимум",
"Сделаем этот год самым любимым",
"Любовь вокруг",
"Наши с тобой моменты навсегда в памяти",
"Каждый день с тобой — это свидание",
"Нам не хватит одного спринта",
"Ты рядом — это мое достижение",
"Горжусь тобой",
"Дарю тебе розу ветров",
"Принимаю тебя любой",
"Ты всегда прекрасна",
"Моя любовь к тебе в беспилотном режиме",
"Люблю твой смех",
"Я всегда буду рядом",
"Из Иннополиса с любовью",
"Hello, love!",
"Лишь количество снега может показать мою любовь",
"Я всегда буду городом твоих идей",
"Ты делаешь меня лучше",
"С любовью, Иннополис"
]

const ITEM_HEIGHT=120
const slot=document.getElementById("slot")
const wrapper=document.getElementById("wrapper")
const download=document.getElementById("download")
const logoImg=document.getElementById("logo")
const bgHeartsRoot=document.getElementById("bg-hearts-root")

// корректно загружаем SVG с GitHub с CORS, чтобы toDataURL работал
if(logoImg){
  logoImg.crossOrigin="anonymous"
  const src=logoImg.getAttribute("data-src")
  if(src){
    logoImg.src=src
  }
}

// мягкие фоновые пиксельные сердечки
function spawnBgHeart(){
  if(!bgHeartsRoot) return

  const h=document.createElement("div")
  h.className="bg-heart"

  const viewportHeight=window.innerHeight || document.documentElement.clientHeight || 700

  const top=20+Math.random()*(viewportHeight-120)
  const left=12+Math.random()*76

  h.style.top=`${top}px`
  h.style.left=`${left}vw`
  h.style.opacity="0"

  bgHeartsRoot.appendChild(h)

  // небольшая вариация размера и длительности анимации
  const scale=0.7+Math.random()*0.9
  const duration=2.3+Math.random()*1.4
  h.style.transform=`translate(-50%,10px) scale(${scale})`
  h.style.animationDuration=`${duration}s`

  setTimeout(()=>h.remove(),duration*1000+500)
}

setInterval(()=>{
  spawnBgHeart()
  spawnBgHeart()
},1500)

let position=0
let target=0
let state="idle"
let selected=0

const LOOP_HEIGHT=messages.length*ITEM_HEIGHT
let idlePhase=0

// build slot
const extended=[...messages,...messages,...messages]

extended.forEach(text=>{

  const div=document.createElement("div")
  div.className="item"
  div.innerText=text
  slot.appendChild(div)

})

function spin(){

  download.style.opacity=0
  download.style.pointerEvents="none"

  selected=Math.floor(Math.random()*messages.length)

  const currentIndex=Math.floor(position/ITEM_HEIGHT)
  const baseCycle=Math.floor(currentIndex/messages.length)*messages.length

  target=(baseCycle+messages.length+selected)*ITEM_HEIGHT

  state="spinning"

}

function animate(){

  if(state==="idle"){
    idlePhase+=0.015
    const baseSpeed=0.5
    const variation=0.2*Math.sin(idlePhase)
    position+=baseSpeed+variation
  }

  if(state==="spinning"){

    const diff=target-position

    position+=diff*0.08

    if(Math.abs(diff)<0.1){

      position=target
      state="stopped"
      download.style.opacity=1
      download.style.pointerEvents="auto"

    }

  }

  // CRITICAL infinite normalization
  if(position>=LOOP_HEIGHT*2){

    position-=LOOP_HEIGHT
    target-=LOOP_HEIGHT

  }

  const translateY=wrapper.clientHeight/2-position-ITEM_HEIGHT/2-2

  slot.style.transform=`translateY(${translateY}px)`

  requestAnimationFrame(animate)

}

animate()


download.onclick=function(){

  const canvas=document.getElementById("canvas")
  const ctx=canvas.getContext("2d")

  const W=canvas.width
  const H=canvas.height

  // фон
  const g=ctx.createLinearGradient(0,0,0,H)
  g.addColorStop(0,"#ffd6e0")
  g.addColorStop(1,"#ffe7d6")

  ctx.fillStyle=g
  ctx.fillRect(0,0,W,H)

  ctx.fillStyle="#2b2b2b"
  ctx.textAlign="center"
  ctx.textBaseline="middle"

  ctx.font="bold 108px sans-serif"

  // фиксированные позиции
  const logoWidth=256
  const logoHeight=logoWidth/(logoImg.naturalWidth/logoImg.naturalHeight)

  const logoY=180
  const heartY=1050

  // логотип всегда фиксирован
  ctx.drawImage(
    logoImg,
    W/2-logoWidth/2,
    logoY,
    logoWidth,
    logoHeight
  )

  // строки текста
  const lines=getTextLines(ctx,messages[selected],900)

  // центр области между логотипом и сердцем
  const top=logoY+logoHeight
  const bottom=heartY

  const OPTICAL_OFFSET = 0.05
  const centerY=(top+bottom)/2 - (bottom-top)*OPTICAL_OFFSET

  drawTextBlockCentered(ctx,lines,W/2,centerY,120)

  // сердце всегда фиксировано
  drawHeart(ctx,W/2,heartY)

  canvas.toBlob(function(blob){

    const url = URL.createObjectURL(blob)

    const link = document.createElement("a")
    link.href = url
    link.target = "_blank"
    link.rel = "noopener"

    document.body.appendChild(link)
    link.click()
    document.body.removeChild(link)

    setTimeout(()=>{
      URL.revokeObjectURL(url)
    },1000)

  }, "image/jpeg", 0.95)

}


function drawText(ctx,text,x,y,maxWidth,lineHeight){

  const words=text.split(" ")
  let line=""

  words.forEach(word=>{

    const test=line+word+" "

    if(ctx.measureText(test).width>maxWidth){

      ctx.fillText(line,x,y)
      line=word+" "
      y+=lineHeight

    }else{

      line=test

    }

  })

  ctx.fillText(line,x,y)

}

function drawHeart(ctx,x,y){

  const size=26

  const shape=[
  [0,1,0,1,0],
  [1,1,1,1,1],
  [1,1,1,1,1],
  [0,1,1,1,0],
  [0,0,1,0,0]
  ]

  ctx.fillStyle="#ff4d6d"

  shape.forEach((row,yy)=>{
    row.forEach((col,xx)=>{
      if(col){
        ctx.fillRect(x+(xx-2)*size,y+(yy-2)*size,size,size)
      }
    })
  })

}

// переопределяем обработчик клика, чтобы центрировать текст и рисовать SVG‑логотип

download.onclick=function(){

  const canvas=document.getElementById("canvas")
  const ctx=canvas.getContext("2d")

  const W=canvas.width
  const H=canvas.height

  // фон
  const g=ctx.createLinearGradient(0,0,0,H)
  g.addColorStop(0,"#ffd6e0")
  g.addColorStop(1,"#ffe7d6")

  ctx.fillStyle=g
  ctx.fillRect(0,0,W,H)

  ctx.fillStyle="#2b2b2b"
  ctx.textAlign="center"
  ctx.textBaseline="middle"

  ctx.font="bold 108px sans-serif"

  // фиксированные позиции
  const logoWidth=256
  const logoHeight=logoWidth/(logoImg.naturalWidth/logoImg.naturalHeight)

  const logoY=180
  const heartY=1050

  // логотип всегда фиксирован
  ctx.drawImage(
    logoImg,
    W/2-logoWidth/2,
    logoY,
    logoWidth,
    logoHeight
  )

  // строки текста
  const lines=getTextLines(ctx,messages[selected],900)

  // центр области между логотипом и сердцем
  const top=logoY+logoHeight
  const bottom=heartY

  const OPTICAL_OFFSET = 0.05
  const centerY=(top+bottom)/2 - (bottom-top)*OPTICAL_OFFSET

  drawTextBlockCentered(ctx,lines,W/2,centerY,120)

  // сердце всегда фиксировано
  drawHeart(ctx,W/2,heartY)

  const url=canvas.toDataURL("image/jpeg",0.95)

  const a=document.createElement("a")
  a.href=url
  a.download="valentine.jpg"
  a.click()

}


function drawTextCentered(ctx,text,x,centerY,maxWidth,lineHeight){

  const words=text.split(" ")
  let line=""
  const lines=[]

  words.forEach(word=>{

    const test=line+word+" "

    if(ctx.measureText(test).width>maxWidth){

      lines.push(line)
      line=word+" "

    }else{

      line=test

    }

  })

  if(line){
    lines.push(line)
  }

  const totalHeight=(lines.length-1)*lineHeight
  let y=centerY-totalHeight/2

  lines.forEach(l=>{
    ctx.fillText(l,x,y)
    y+=lineHeight
  })
}


function getTextLines(ctx,text,maxWidth){

  const words=text.split(" ")
  const lines=[]
  let line=""

  words.forEach(word=>{

    const test=line+word+" "

    if(ctx.measureText(test).width>maxWidth){
      lines.push(line)
      line=word+" "
    }else{
      line=test
    }

  })

  if(line) lines.push(line)

  return lines

}

function drawTextBlockCentered(ctx,lines,x,centerY,lineHeight){

  const totalHeight=lines.length*lineHeight

  let y=centerY-totalHeight/2+lineHeight/2

  lines.forEach(line=>{
    ctx.fillText(line,x,y)
    y+=lineHeight
  })

}

function drawHeart(ctx,x,y){

  const size=26

  const shape=[
  [0,1,0,1,0],
  [1,1,1,1,1],
  [1,1,1,1,1],
  [0,1,1,1,0],
  [0,0,1,0,0]
  ]

  const heartSize=shape.length*size
  const offset=heartSize/2

  ctx.fillStyle="#ff4d6d"

  shape.forEach((row,yy)=>{
    row.forEach((col,xx)=>{
      if(col){
        ctx.fillRect(
          x-offset+xx*size,
          y-offset+yy*size,
          size,
          size
        )
      }
    })
  })

}

</script>

</body>
</html>
